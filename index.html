<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Sdav assignment2 by Kajs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">

    <script text/javascript" src="d3.js"></script>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Sdav assignment2</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/Kajs/SDAV_Assignment2" class="btn">View on GitHub</a>
      <a href="https://github.com/Kajs/SDAV_Assignment2/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Kajs/SDAV_Assignment2/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>Assignment 2A: Simple SVG stuff</h2>
        <svg>
          <rect x="0" y="20" width="80" height="80" fill="purple" fill-opacity="1.0" stroke="gray" stroke-width="2"/>
          <rect x="20" y="15" width="80" height="80" fill="blue" fill-opacity="0.8" stroke="gray" stroke-width="2"/>
          <rect x="40" y="10" width="80" height="80" fill="green" fill-opacity="0.6" stroke="gray" stroke-width="2"/>
          <rect x="60" y="5" width="80" height="80" fill="yellow" fill-opacity="0.4" stroke="gray" stroke-width="2"/>
          <rect x="80" y="0" width="80" height="80" fill="red" fill-opacity="0.2" stroke="gray" stroke-width="2"/>
        </svg>

      <h2>Assignment 2B: One scatter plot and two datasets</h2>
        <script type="text/javascript">
          var dataset; //Declare global var
          var crimeCounts2013 = [];
          var crimeCounts2015 = [];

          d3.csv("sfpd_cropped.csv", function(data) {
            dataset = data;

            data.forEach(function(d) {
              var found = false;
              var prostitution = 0;
              if(d.Category == "PROSTITUTION") { prostitution = 1; }
              var vehicleTheft = 0;
              if (d.Category == "VEHICLE THEFT") { vehicleTheft = 1; }
              
              if (d.Date == 2013) {
                for (i = 0; i < crimeCounts2013.length; i++) { 
                  if (d.PdDistrict == crimeCounts2013[i].PdDistrict) {
                    crimeCounts2013[i].Prostitution = crimeCounts2013[i].Prostitution + prostitution;
                    crimeCounts2013[i].VehicleTheft = crimeCounts2013[i].VehicleTheft + vehicleTheft;
                    found = true;
                    break;
                  }
                }
                if (found == false) { crimeCounts2013.push({ "PdDistrict": d.PdDistrict, "Prostitution": prostitution, "VehicleTheft": vehicleTheft}); }
              }

              if (d.Date == 2015) {
                for (i = 0; i < crimeCounts2015.length; i++) { 
                  if (d.PdDistrict == crimeCounts2015[i].PdDistrict) {
                    crimeCounts2015[i].Prostitution = crimeCounts2015[i].Prostitution + prostitution;
                    crimeCounts2015[i].VehicleTheft = crimeCounts2015[i].VehicleTheft + vehicleTheft;
                    found = true;
                    break;
                  }
                }
                if (found == false) { crimeCounts2015.push({ "PdDistrict": d.PdDistrict, "Prostitution": prostitution, "VehicleTheft": vehicleTheft}); }
              }
            });

            //console.log("2013:");
            //for (i = 0; i < crimeCounts2013.length; i++) { console.log(crimeCounts2013[i]);}
            //console.log("\n");
            //console.log("2015:");
            //for (i = 0; i < crimeCounts2015.length; i++) { console.log(crimeCounts2015[i]); }
            //console.log("\n");


            var w = 1200;
            var h = 700;
            var minR = 1;
            var maxR = 50;
            var minX = maxR;
            var maxX = w - maxR;
            var minY = maxR;
            var maxY = h - maxR;

            var scaleRadius = d3.scale.linear();
            scaleRadius.domain([0, 4000]);
            scaleRadius.range([minR, maxR]);

            var scaleWidth = d3.scale.linear();
            scaleWidth.domain([0, 500]);
            scaleWidth.range([minX, maxX]);

            var scaleHeight = d3.scale.linear();
            scaleHeight.domain([0, 1400]);
            scaleHeight.range([minY, maxY]);

            var svgContainer;
            var crimeData;
            var year = 2015;


            function update() {
              if (svgContainer != null) { svgContainer.remove(); }
              
              if (year == 2015) {
                year = 2013;
                crimeData = crimeCounts2013;
              }
              else {
                year = 2015;
                crimeData = crimeCounts2015;
              }

              svgContainer = d3.select("body").append("svg")
                                       .attr("width", w)
                                       .attr("height", h)
                                       .on('click', function(d,i) { update();  });
              var circles = svgContainer.selectAll("circle")
                            .data(crimeData)
                            .enter()
                            .append("circle");

              var circleAttributes = circles
                .attr("cx", function (d) { return scaleWidth(d.Prostitution); })
                .attr("cy", function (d) { return maxY - scaleHeight(d.VehicleTheft); })
                .attr("r", function (d) { return scaleRadius(d.Prostitution + d.VehicleTheft); })
                .style("fill", function(d) { return "blue"; });

              var labels = svgContainer.selectAll("text")
                .data(crimeData)
                .enter()
                .append("text")

              var labelAttributes = labels
                .text(function(d) { return d.PdDistrict; })
                .attr("x", function(d) { return scaleWidth(d.Prostitution); })
                .attr("y", function(d) { return maxY - scaleHeight(d.VehicleTheft); });

              var xBorder = svgContainer.append("line")
                .attr("x1", minX)
                .attr("y1", maxY)
                .attr("x2", maxX)
                .attr("y2", maxY)
                .attr("stroke-width", 2)
                .attr("stroke", "black");

              var yBorder = svgContainer.append("line")
                .attr("x1", minX)
                .attr("y1", maxY)
                .attr("x2", minX)
                .attr("y2", minY)
                .attr("stroke-width", 2)
                .attr("stroke", "black");

              var headline = svgContainer.append("text")
                .text(function(d) { return year })
                .attr("x", function(d) { return 0 })
                .attr("y", function(d) { return 0 });
            }
 
            update();


          });

        </script>
    </section>

  
  </body>
</html>
